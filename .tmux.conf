# ============================================================================
# TERMINAL & DISPLAY SETTINGS
# ============================================================================

# Terminal colors and features
set -g default-terminal "tmux-256color"
set -ag terminal-overrides ",xterm-256color:RGB"
set-option -a terminal-features 'alacritty:RGB'

# Status bar configuration
set-option -g status-position bottom
set-option -g status-interval 5
set -g status-right-length 100
set -g status-left-length 100

# History and timing
set-option -g history-limit 50000000
set -g repeat-time 2000
set -s escape-time 0

# ============================================================================
# GENERAL SETTINGS
# ============================================================================

# Default shell
set-option -g default-shell /opt/homebrew/bin/fish

# Window management
setw -g automatic-rename on   # Rename window to reflect current program
set -g renumber-windows on    # Renumber windows when a window is closed

# Mouse support
set -g mouse on
unbind -n WheelUpStatus
unbind -n WheelDownStatus

# Clipboard and OSC52 passthrough (for remote sessions)
set -g set-clipboard on
set -as terminal-overrides ',xterm-ghostty:Ms=\E]52;%p1%s;%p2%s\007'
set -as terminal-overrides ',screen*:Ms=\E]52;%p1%s;%p2%s\007'
set -as terminal-overrides ',tmux*:Ms=\E]52;%p1%s;%p2%s\007'
set -g allow-passthrough on

# ============================================================================
# KEY BINDINGS
# ============================================================================

# Prefix key configuration
set -g prefix C-space
set-option -g prefix2 C-b
bind-key C-space send-prefix

# Find session
bind C-f command-prompt -p find-session 'switch-client -t %%'

# Reload configuration
unbind r
bind r source-file ~/.tmux.conf \; display-message "Tmux config reloaded"

# ──────────────────────────────────────────────────────────────────────────
# Window Management
# ──────────────────────────────────────────────────────────────────────────

# Split windows
unbind %
unbind '"'
bind | split-window -h
bind - split-window -v

# Close pane/window
unbind x
bind-key x kill-pane

# Navigate windows
bind TAB last-window
bind -r H previous-window
bind -r L next-window

# Swap windows (move left/right)
bind-key -n C-S-Left swap-window -t -1\; select-window -t -1
bind-key -n C-S-Right swap-window -t +1\; select-window -t +1
bind-key -n M-H swap-window -t -1\; select-window -t -1
bind-key -n M-L swap-window -t +1\; select-window -t +1
bind -n M-u run 'tmux swap-window -d -t #{e|-|:#I,1}'
bind -n M-i run 'tmux swap-window -d -t #{e|+|:#I,1}'
bind -r u run 'tmux swap-window -d -t #{e|-|:#I,1}'
bind -r i run 'tmux swap-window -d -t #{e|+|:#I,1}'

# ──────────────────────────────────────────────────────────────────────────
# Pane Management
# ──────────────────────────────────────────────────────────────────────────

# Navigate panes (vim-style with prefix)
bind h select-pane -L
bind j select-pane -D
bind k select-pane -U
bind l select-pane -R

# Navigate panes (vim-style without prefix)
bind -n M-h select-pane -L
bind -n M-l select-pane -R
bind -n M-j select-pane -U
bind -n M-k select-pane -D

# Resize panes with arrow keys
bind -r Left resize-pane -L 5
bind -r Down resize-pane -D 5
bind -r Up resize-pane -U 5
bind -r Right resize-pane -R 5

# Resize panes with J/K
bind -r J resize-pane -D 5
bind -r K resize-pane -U 5

# Maximize/minimize pane
bind -r m resize-pane -Z

# ──────────────────────────────────────────────────────────────────────────
# Copy Mode (Vi-style)
# ──────────────────────────────────────────────────────────────────────────

# Enable vi mode
set-window-option -g mode-keys vi

# Vi-style copy bindings
bind-key -T copy-mode-vi 'v' send -X begin-selection
bind -T copy-mode-vi C-v send-keys -X rectangle-toggle
bind-key -T copy-mode-vi y send -X copy-selection
bind-key -T copy-mode-vi Escape send -X cancel

# Don't exit copy mode when dragging with mouse
unbind -T copy-mode-vi MouseDragEnd1Pane

# Search with /
unbind "/"
bind "/" copy-mode \; send-keys '?'

# ──────────────────────────────────────────────────────────────────────────
# Utility Bindings
# ──────────────────────────────────────────────────────────────────────────

# Clear screen and history
bind -n C-l send-keys C-l \; run 'sleep 0.2' \; clear-history
bind -n M-K send-keys -R \; clear-history \;
bind -n M-';' send-keys -R \; clear-history \;

# ============================================================================
# PLUGINS
# ============================================================================

# Plugin manager (TPM)
set -g @plugin 'tmux-plugins/tpm'

# Fuzzy finder integration
set -g @plugin 'sainnhe/tmux-fzf'
set -g @plugin 'wfxr/tmux-fzf-url'
set -g @fzf-url-bind 'o'

# Tmux-power theme
set -g @plugin 'wfxr/tmux-power'

# ============================================================================
# THEME CONFIGURATION (tmux-power with GitHub Dark colors)
# ============================================================================

# Set custom GitHub Dark colors for tmux-power
set -g @tmux_power_theme '#58a6ff'  # GitHub Blue accent

# Customize gradient colors to match GitHub Dark theme
set -g @tmux_power_g0 "#0A0C10"  # Main background (status bar)
set -g @tmux_power_g1 "#161b22"  # Secondary background
set -g @tmux_power_g2 "#21262d"  # Tertiary background
set -g @tmux_power_g3 "#30363d"  # Borders/subtle elements
set -g @tmux_power_g4 "#c9d1d9"  # Foreground text color

# Date and time format
set -g @tmux_power_date_format '%Y-%m-%d'
set -g @tmux_power_time_format '%H:%M'

# Use simple text icons instead of Nerd Fonts (to avoid broken icons)
set -g @tmux_power_date_icon '󰃰'
set -g @tmux_power_time_icon '󰥔'
set -g @tmux_power_session_icon ''
set -g @tmux_power_left_arrow_icon ''
set -g @tmux_power_right_arrow_icon ''

# Hide user and host information
set -g @tmux_power_show_user false
set -g @tmux_power_show_host false

# Hide network speed
set -g @tmux_power_show_upload_speed false
set -g @tmux_power_show_download_speed false

# Show session
set -g @tmux_power_show_session true

# ============================================================================
# INITIALIZE PLUGIN MANAGER
# ============================================================================

run '~/.tmux/plugins/tpm/tpm'

# ============================================================================
# CUSTOM PREFIX INDICATOR (applied after tmux-power loads)
# ============================================================================

# Custom status-left with prefix indicator and  icon
# When prefix is pressed (Ctrl+Space), the session background changes to yellow
set -g status-left "#{?client_prefix,#[fg=#0A0C10]#[bg=#d29922]#[bold],#[fg=#0A0C10]#[bg=#3fb950]#[bold]}   #S #{?client_prefix,#[fg=#d29922]#[bg=#0A0C10],#[fg=#3fb950]#[bg=#0A0C10]} "

# Custom status-right with better color variety
set -g status-right "#[fg=#21262d,bg=#0A0C10]#[fg=#0A0C10,bg=#21262d,bold] 󰥔 %H:%M #[fg=#58a6ff,bg=#21262d]#[fg=#0A0C10,bg=#58a6ff,bold] 󰃰 %Y-%m-%d "

# Pane border colors (override after tmux-power)
set -g pane-border-style "fg=#30363d"
set -g pane-active-border-style "fg=#58a6ff"

# Add spacing above status bar for visual separation
if -F '#{!=:#{status},2}' {
    set -Fg 'status-format[1]' '#{status-format[0]}'
    set -g 'status-format[0]' ''
    set -g status 2
}

# Mode style for copy mode
set -g mode-style "bg=#58a6ff,fg=#0A0C10"
