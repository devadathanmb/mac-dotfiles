---
- name: Check if VSCode is installed
  ansible.builtin.command:
    cmd: which code
  register: code_check
  ignore_errors: true
  changed_when: false

- name: Read VSCode extensions from file
  ansible.builtin.set_fact:
    vscode_extensions: "{{ lookup('file', dotfiles_repo + '/configs/vscode/extensions.txt').splitlines() | reject('==', '') | list }}"
  when: code_check.rc == 0

- name: Install VSCode extensions
  ansible.builtin.command:
    cmd: "code --install-extension {{ item }}"
  loop: "{{ vscode_extensions }}"
  when: code_check.rc == 0
  ignore_errors: true
  changed_when: false

- name: Check if Cursor is installed
  ansible.builtin.command:
    cmd: which cursor
  register: cursor_check
  ignore_errors: true
  changed_when: false

- name: Read Cursor extensions from file
  ansible.builtin.set_fact:
    cursor_extensions: "{{ lookup('file', dotfiles_repo + '/configs/cursor/extensions.txt').splitlines() | reject('==', '') | list }}"
  when: cursor_check.rc == 0

- name: Install Cursor extensions
  ansible.builtin.command:
    cmd: "cursor --install-extension {{ item }}"
  loop: "{{ cursor_extensions }}"
  when: cursor_check.rc == 0
  ignore_errors: true
  changed_when: false

- name: Display extension installation summary
  ansible.builtin.debug:
    msg: "VSCode and/or Cursor extensions installed. Some may have failed (deprecated extensions)."
